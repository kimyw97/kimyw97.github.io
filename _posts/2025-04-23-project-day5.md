---
layout: post
title: "2025.04.23 - A4988 + CNC Shield + STM32: 스텝 모터 제어 실습"
date: 2025-04-23 21:00:00 +0900
categories: stm32 motor-control stepper
---

## 📌 오늘 한 일

- 6핀 NEMA17 스텝 모터의 구조 및 작동 원리 학습
- A4988 드라이버의 작동 원리 및 핀 구성 이해
- A4988용 CNC Shield V3 보드 구조 파악
- STM32와 A4988 연결 및 모터 제어 준비

---

## ⚙️ NEMA17 (6핀) 스텝 모터 핀아웃

6핀 모터의 경우 내부에는 2개의 코일이 존재하며 각 코일의 중심탭을 포함:

```
[1] A+  
[2] A center tap  
[3] A−  
[4] B+  
[5] B center tap  
[6] B−
```

A4988 같은 bipolar 드라이버 사용 시에는 center tap([2], [5])은 사용하지 않고, 양쪽 끝단([1]-[3], [4]-[6])만 사용한다.

---

## 🔌 A4988 드라이버 핀 설명

| 핀 번호 | 핀 이름 | 설명 |
|---------|----------|------|
| 1       | VMOT     | 모터 전원 입력 (8~35V) |
| 2       | GND      | 모터 GND |
| 3       | 2B       | 스텝 모터 B코일 음극 |
| 4       | 2A       | 스텝 모터 B코일 양극 |
| 5       | 1A       | 스텝 모터 A코일 양극 |
| 6       | 1B       | 스텝 모터 A코일 음극 |
| 7       | VDD      | 로직 전원 입력 (3~5V) |
| 8       | GND      | 로직 GND |
| 9       | STEP     | 스텝 펄스 입력 (HIGH 펄스 시 1스텝 이동) |
| 10      | DIR      | 회전 방향 설정 |
| 11      | ENABLE   | LOW일 때 활성화 |
| 12~14   | MS1~MS3  | 마이크로스텝 설정 |
| 15      | RESET    | LOW이면 리셋 |
| 16      | SLEEP    | LOW이면 슬립모드 진입 |

---

## 🧱 CNC Shield V3 구조

- Arduino UNO 폼팩터에 맞춰 A4988 모듈을 꽂을 수 있는 4개의 슬롯 제공 (X, Y, Z, A)
- 각 축에는 STEP/DIR 핀이 아두이노 핀과 매핑되어 있음 (STM32 사용 시 수동 연결 필요)
- 각 축마다 Enable 핀은 공통으로 묶여 있음

---

## 🛠️ STM32와 A4988 연결 예시

| A4988 핀 | STM32 핀 예시  | 설명           |
|----------|----------------|----------------|
| STEP     | PA0            | 타이머 출력 핀 |
| DIR      | PA1            | GPIO 출력 핀   |
| ENABLE   | GND 또는 GPIO  | LOW로 활성화   |
| 1A~2B    | 스텝모터 연결  | 코일 매칭 필요 |
| VMOT     | 외부 전원 (12V)| 모터 구동용    |
| VDD      | 3.3V 또는 5V   | 로직 구동용    |

---

## 🔄 A4988 제어 원리 요약

- DIR 핀으로 방향 설정 (`HIGH` 또는 `LOW`)
- STEP 핀에 짧은 펄스를 인가하면 1스텝 이동 (최소 펄스 폭 1μs 이상)
- 마이크로스텝 조정 시 MS1~MS3 핀 설정 필요
- ENABLE 핀을 LOW로 설정하면 드라이버가 동작

---

## ✅ 다음 목표

- STM32 타이머를 활용한 STEP 신호 생성 코드 작성
- 마이크로스텝 설정 실험 (FULL, HALF, 1/4, ...)
- 여러 축(X/Y) 모터를 동시에 제어하는 멀티 태스크 구조 설계

---
