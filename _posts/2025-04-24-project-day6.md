---
layout: post
title: "2025.04.24 - STM32 & A4988 기반 스텝모터 제어 디버깅"
date: 2025-04-24 14:00:00 +0900
categories: kongi-patji project
---

## 📌 오늘 한 일
- STM32 + A4988 + CNC Shield를 사용한 Nema17 스텝모터 제어 회로 구성
- FreeRTOS 기반 모터 제어 로직 작성
- 5V 전원 관련 디버깅 및 CNC Shield 연결 문제 확인

---

## ⚙️ 시스템 구성

### 💡 하드웨어
- STM32F4 Discovery
- A4988 드라이버 (CNC Shield V3)
- Nema17 스텝모터 (17HS3401)
- 24V 모터 전원
- 공통 GND, 5V 연결 주의

### 📌 연결 요약
| STM32 핀 | CNC Shield 상단 핀 | 기능 |
|----------|--------------------|------|
| GPIO     | STEP               | Step 신호 출력 |
| GPIO     | DIR                | 방향 제어 |
| GPIO     | EN                 | 드라이버 Enable |
| 5V       | VDD                | 논리 전원 (권장: 외부 안정된 5V) |
| GND      | GND                | 공통 접지 |
| 24V      | VMOT               | 모터 전원 (A4988 기준) |

> **주의**: STM32 보드의 5V 출력을 CNC Shield 전원으로 쓰는 것은 권장하지 않음. 전압 강하 및 전류 부족 가능성 있음.

---

## 🔍 문제 상황 및 점검 내용

| 체크 항목 | 상태 |
|-----------|------|
| ✅ 24V Vmot 공급됨 | ✔️ |
| ⚠️ Vref 전압 너무 낮지 않은지 | ✔️ |
| ⚠️ 마이크로스텝 점퍼 제거 (Full Step로 테스트) | ✔️ |
| ⚠️ STEP 신호를 delay_us()로 생성하고 있는지 | ✔️ |
| ⚠️ EN 핀 LOW로 설정됨 | ✔️ |
| ⚠️ 모터 배선이 올바르게 연결되었는지 | ✔️ |

### ➕ 추가 확인
- A4988 모듈 단독 Arduino 제어 테스트 결과 문제 없음
- STM32의 5V 핀 전압 측정 결과: 약 4.65V로, CNC Shield 동작 불안정 가능성 있음
- 쉴드 A4988 모듈 기준 VDD 핀 a, b 중 **a만 3V 출력** 확인 → 핀 불량 없음

---

## 🧪 디버깅 및 개선 방향

1. **외부 5V 레귤레이터 사용** 추천
   - STM32 보드가 공급하는 5V는 전류 용량이 작아 A4988 + CNC Shield 구동에는 부족할 수 있음

2. **GND 공통 필수**
   - STM32, 외부 전원, CNC Shield 간 GND 반드시 연결

---
